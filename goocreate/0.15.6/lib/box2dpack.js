goo.Box2DSystem=function(t){"use strict";function o(){t.call(this,"Box2DSystem",["Box2DComponent","MeshDataComponent"]),this.SCALE=.5,this.world=new Box2D.b2World(new Box2D.b2Vec2(0,-9.81)),this.sortVertexesClockWise=function(t,o){var e=Math.atan2(t.get_y(),t.get_x()),n=Math.atan2(o.get_y(),o.get_x());return e>n?1:-1},this.velocityIterations=8,this.positionIterations=3;var o=4;this.createPolygonShape=function(t){for(var e=new Box2D.b2PolygonShape,n=Box2D.allocate(t.length*o*2,"float",Box2D.ALLOC_STACK),s=0,r=0;r<t.length;r++)Box2D.setValue(n+s,t[r].get_x(),"float"),Box2D.setValue(n+(s+o),t[r].get_y(),"float"),s+=2*o;var i=Box2D.wrapPointer(n,Box2D.b2Vec2);return e.Set(i,t.length),e}}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.inserted=function(t){var o=t.box2DComponent,e=0,n=0,s=new Box2D.b2PolygonShape;if("box"===o.shape)s.SetAsBox(o.width*this.SCALE,o.height*this.SCALE);else if("circle"===o.shape)s=new Box2D.b2CircleShape,s.set_m_radius(o.radius);else if("mesh"===o.shape){for(var r=t.meshDataComponent.meshData,i=r.getAttributeBuffer("POSITION"),a=0,h=[],p=1/0,f=-(1/0),l=1/0,c=-(1/0);a<=i.length-3;){var y=i[a],d=i[++a];p>d&&(p=d),d>f&&(f=d),l>y&&(l=y),y>c&&(c=y),++a,t.transformComponent.updateWorldTransform();var m=new Box2D.b2Vec2(y,d);h.push(m)}s=this.createPolygonShape(h),e=f-p,n=c-l}else if("polygon"===o.shape){for(var h=[],a=0;a<=o.vertices.length-2;){var m=new Box2D.b2Vec2(o.vertices[a],o.vertices[++a]);h.push(m),++a}s=this.createPolygonShape(h)}var u=new Box2D.b2FixtureDef;u.set_shape(s),u.set_density(1),u.set_friction(o.friction),u.set_restitution(o.restitution);var x=new Box2D.b2BodyDef;o.movable===!0&&x.set_type(Box2D.b2_dynamicBody),x.set_position(new Box2D.b2Vec2(t.transformComponent.transform.translation.x+o.offsetX,t.transformComponent.transform.translation.y+o.offsetY));var g=t.transformComponent.transform.rotation.toAngles();x.set_angle(g.z);var D=this.world.CreateBody(x);D.CreateFixture(u),D.SetLinearDamping(.95),D.SetAngularDamping(.6),o.body=D,o.world=this.world,t.body=D,t.body.h=e,t.body.w=n},o.prototype.deleted=function(t){this.world.DestroyBody(t.body)},o.prototype.process=function(t,o){this.world.Step(o,this.velocityIterations,this.positionIterations);for(var e=0;e<t.length;e++){var n=t[e],s=n.transformComponent,r=s.transform,i=n.body.GetPosition(),a=i.get_x(),h=i.get_y();-10>h?n.removeFromWorld():(r.translation.x=a-n.box2DComponent.offsetX,r.translation.y=h-n.box2DComponent.offsetY,s.setRotation(0,0,n.body.GetAngle()),s.setUpdated())}},o}(goo.System),goo.Box2DComponent=function(t){"use strict";function o(o){t.apply(this,arguments),this.type="Box2DComponent",this.body=null,this.world=null,this.mass=1,this.settings=o||{},this.shape=o.shape?o.shape:"box",this.width=o.width?o.width:1,this.height=o.height?o.height:1,this.radius=o.radius?o.radius:1,this.vertices=o.vertices?o.vertices:[0,1,2,2,0,2],this.movable=o.movable!==!1,this.friction=o.friction?o.friction:1,this.restitution=o.restitution?o.restitution:0,this.offsetX=o.offsetX?o.offsetX:0,this.offsetY=o.offsetY?o.offsetY:0}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o}(goo.Component),"function"==typeof require&&(define("goo/addons/box2dpack/systems/Box2DSystem",[],function(){return goo.Box2DSystem}),define("goo/addons/box2dpack/components/Box2DComponent",[],function(){return goo.Box2DComponent}));