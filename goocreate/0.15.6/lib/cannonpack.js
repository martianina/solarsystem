goo.CannonBoxColliderComponent=function(o,n,t){"use strict";function e(n){o.apply(this,arguments),this.type="CannonBoxColliderComponent",n=n||{};var e=this.halfExtents=n.halfExtents||new t(.5,.5,.5);this.cannonShape=new CANNON.Box(new CANNON.Vec3(e.x,e.y,e.z)),this.isTrigger="undefined"!=typeof n.isTrigger?n.isTrigger:!1}return e.prototype=Object.create(o.prototype),e.constructor=e,e}(goo.Component,goo.Box,goo.Vector3),goo.CannonCylinderColliderComponent=function(o){"use strict";function n(n){o.apply(this,arguments),n=n||{},this.type="CannonCylinderColliderComponent";var t="number"==typeof n.radiusTop?n.radiusTop:.5,e="number"==typeof n.radiusBottom?n.radiusBottom:.5,i="number"==typeof n.height?n.height:1,r="number"==typeof n.numSegments?n.numSegments:10;this.cannonShape=new CANNON.Cylinder(t,e,i,r)}return n.prototype=Object.create(o.prototype),n.constructor=n,n}(goo.Component),goo.CannonPlaneColliderComponent=function(o){"use strict";function n(n){o.apply(this,arguments),this.type="CannonPlaneColliderComponent",n=n||{},this.cannonShape=new CANNON.Plane}return n.prototype=Object.create(o.prototype),n.constructor=n,n}(goo.Component),goo.CannonDistanceJointComponent=function(o,n){"use strict";function t(t){o.apply(this,arguments),t=t||{},this.type="CannonDistanceJointComponent",n.defaults(t,{distance:1,connectedBody:null}),this.distance=t.distance,this.connectedBody=t.connectedBody,this.cannonConstraint=null}return t.prototype=Object.create(o.prototype),t.constructor=t,t.prototype.createConstraint=function(o){var n=o.cannonRigidbodyComponent.body,t=this.connectedBody.body;return this.cannonConstraint=new CANNON.DistanceConstraint(n,t,this.distance),this.cannonConstraint},t}(goo.Component,goo.ObjectUtils),goo.CannonRigidbodyComponent=function(o,n,t,e,i,r,a,s){"use strict";function p(n){o.apply(this,arguments),n=n||{},this.type="CannonRigidbodyComponent",s.defaults(n,{mass:1,velocity:new t}),this.mass=n.mass,this._initialPosition=null,this._initialVelocity=new t,this._initialVelocity.setVector(n.velocity),this.body=null,this.centerOfMassOffset=new t}p.prototype=Object.create(o.prototype),p.constructor=p,p.prototype.api={setForce:function(o){p.prototype.setForce.call(this.cannonRigidbodyComponent,o)},setVelocity:function(o){p.prototype.setVelocity.call(this.cannonRigidbodyComponent,o)},setPosition:function(o){p.prototype.setPosition.call(this.cannonRigidbodyComponent,o)},setAngularVelocity:function(o){p.prototype.setAngularVelocity.call(this.cannonRigidbodyComponent,o)}};var c=new n;return p.prototype.setForce=function(o){this.body.force.set(o.x,o.y,o.z)},p.prototype.setVelocity=function(o){this.body.velocity.set(o.x,o.y,o.z)},p.prototype.setPosition=function(o){this.body?this.body.position.set(o.x,o.y,o.z):this._initialPosition=new t(o)},p.prototype.setAngularVelocity=function(o){this.body.angularVelocity.set(o.x,o.y,o.z)},p.getCollider=function(o){return o.cannonBoxColliderComponent||o.cannonPlaneColliderComponent||o.cannonSphereColliderComponent||o.cannonTerrainColliderComponent||o.cannonCylinderColliderComponent||null},p.prototype.addShapesToBody=function(o){var n=o.cannonRigidbodyComponent.body,t=p.getCollider(o);if(t)n.addShape(t.cannonShape);else{var i=o.transformComponent.worldTransform,r=new e;r.copy(i),r.invert(r);var a=new e,s=this.centerOfMassOffset;o.traverse(function(o){var t=p.getCollider(o);if(t){a.copy(o.transformComponent.worldTransform);var i=new e;e.combine(r,a,i),i.update();var d=i.translation,l=i.rotation,C=new CANNON.Vec3(d.x,d.y,d.z),y=c;y.fromRotationMatrix(l);var u=new CANNON.Quaternion(y.x,y.y,y.z,y.w);C.vadd(s,C),t.isTrigger&&(t.cannonShape.collisionResponse=!1),n.addShape(t.cannonShape,C,u)}})}},p}(goo.Component,goo.Quaternion,goo.Vector3,goo.Transform,goo.Box,goo.Sphere,goo.Quad,goo.ObjectUtils),goo.CannonSphereColliderComponent=function(o){"use strict";function n(n){o.apply(this,arguments),n=n||{},this.type="CannonSphereColliderComponent",this.radius=n.radius||.5,this.cannonShape=new CANNON.Sphere(this.radius)}return n.prototype=Object.create(o.prototype),n.constructor=n,n}(goo.Component),goo.CannonSystem=function(o,n,t,e,i,r,a){"use strict";function s(n){o.call(this,"CannonSystem",["CannonRigidbodyComponent","TransformComponent"]),n=n||{},a.defaults(n,{gravity:new r(0,-10,0),stepFrequency:60,broadphase:"naive"}),this.priority=1;var t=this.world=new CANNON.World;t.gravity.x=n.gravity.x,t.gravity.y=n.gravity.y,t.gravity.z=n.gravity.z,this.setBroadphaseAlgorithm(n.broadphase),this.stepFrequency=n.stepFrequency,this.maxSubSteps=n.maxSubSteps||0}var p=new e;s.prototype=Object.create(o.prototype),s.prototype.constructor=s,s.prototype.reset=function(){for(var o=0;o<this._activeEntities.length;o++){var n=this._activeEntities[o];if(n.cannonRigidbodyComponent.added){var t=n.cannonRigidbodyComponent.body,i=n.transformComponent.worldTransform.translation,r=new e;r.fromRotationMatrix(n.transformComponent.worldTransform.rotation),t.position.set(i.x,i.y,i.z),t.quaternion.set(r.x,r.y,r.z,r.w),t.velocity.set(0,0,0),t.angularVelocity.set(0,0,0)}}},s.prototype.inserted=function(o){var n=o.cannonRigidbodyComponent;n.body=null},s.prototype.deleted=function(o){var n=o.cannonRigidbodyComponent;n&&n.body&&(this.world.remove(n.body),n.body=null)};var c=new r;return s.prototype.process=function(o){for(var n=this.world,t=0;t<o.length;t++){var e=o[t],i=e.cannonRigidbodyComponent;if(!i||!i.added){var r=e.transformComponent,a=new CANNON.Body({mass:i.mass});if(i.body=a,i.addShapesToBody(e),a.shapes.length){i._initialPosition?e.setPosition(i._initialPosition):e.setPosition(r.transform.translation),e.setVelocity(i._initialVelocity);var s=p;s.fromRotationMatrix(r.transform.rotation),a.quaternion.set(s.x,s.y,s.z,s.w),n.add(a);var d=e.cannonDistanceJointComponent;d&&n.addConstraint(d.createConstraint(e)),i.added=!0}else e.clearComponent("CannonRigidbodyComponent")}}var l=1/this.stepFrequency,C=this.maxSubSteps;if(C){var y=performance.now()/1e3;this._lastTime||(this._lastTime=y);var u=y-this._lastTime;this._lastTime=y,n.step(l,u,C)}else n.step(l);for(var t=0;t<o.length;t++){var e=o[t],m=e.cannonRigidbodyComponent;if(m){m.body.computeAABB();var h=m.body.quaternion,g=m.body.position;h.vmult(m.centerOfMassOffset,c),g.vadd(c,c),e.transformComponent.setTranslation(c.x,c.y,c.z),p.set(h.x,h.y,h.z,h.w),e.transformComponent.transform.rotation.copyQuaternion(p),e.transformComponent.setUpdated()}}},s.prototype.setBroadphaseAlgorithm=function(o){var n=this.world;switch(o){case"naive":n.broadphase=new CANNON.NaiveBroadphase;break;case"sap":n.broadphase=new CANNON.SAPBroadphase(n);break;default:throw new Error("Broadphase not supported: "+o)}},s}(goo.System,goo.BoundingBox,goo.BoundingSphere,goo.Quaternion,goo.Transform,goo.Vector3,goo.ObjectUtils),goo.CannonTerrainColliderComponent=function(o){"use strict";function n(n){o.apply(this,arguments),this.type="CannonTerrainColliderComponent",n=n||{data:[],shapeOptions:{}},this.cannonShape=new CANNON.Heightfield(n.data,n.shapeOptions)}return n.prototype=Object.create(o.prototype),n.constructor=n,n}(goo.Component),"function"==typeof require&&(define("goo/addons/cannonpack/CannonBoxColliderComponent",[],function(){return goo.CannonBoxColliderComponent}),define("goo/addons/cannonpack/CannonCylinderColliderComponent",[],function(){return goo.CannonCylinderColliderComponent}),define("goo/addons/cannonpack/CannonPlaneColliderComponent",[],function(){return goo.CannonPlaneColliderComponent}),define("goo/addons/cannonpack/CannonDistanceJointComponent",[],function(){return goo.CannonDistanceJointComponent}),define("goo/addons/cannonpack/CannonRigidbodyComponent",[],function(){return goo.CannonRigidbodyComponent}),define("goo/addons/cannonpack/CannonSphereColliderComponent",[],function(){return goo.CannonSphereColliderComponent}),define("goo/addons/cannonpack/CannonSystem",[],function(){return goo.CannonSystem}),define("goo/addons/cannonpack/CannonTerrainColliderComponent",[],function(){return goo.CannonTerrainColliderComponent}));